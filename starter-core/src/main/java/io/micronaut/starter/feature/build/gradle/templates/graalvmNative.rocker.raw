@import io.micronaut.starter.application.ApplicationType
@import io.micronaut.starter.build.gradle.GradleDsl
@import io.micronaut.starter.feature.Features
@args (
String packageName,
ApplicationType applicationType,
Features features,
GradleDsl dsl
)

@if (applicationType == ApplicationType.DEFAULT || features.contains("oracle-function")) {
    @if(dsl == GradleDsl.KOTLIN) {
graalvmNative.toolchainDetection.set(false)
    } else {
graalvmNative.toolchainDetection = false
    }
}

@if (features.contains("oracle-function")) {
@if (features.contains("oracle-function-http")) {
graalvmNative {
    binaries.configureEach {
        buildArgs.add("--initialize-at-build-time=@(packageName)")
    }
}
} else {
graalvmNative {
    binaries.configureEach {
        buildArgs.addAll(
             "-H:+StaticExecutableWithDynamicLibC",
             "-Dfn.handler=@(packageName).Function::handleRequest",
             "--initialize-at-build-time=@(packageName)"
        )
    }
}
}
}
